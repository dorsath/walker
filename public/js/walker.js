// Generated by CoffeeScript 1.3.3
(function() {
  var Walker;

  Walker = (function() {

    function Walker() {
      this.mvMatrixStack = [];
      this.mvMatrix = Matrix.I(4);
      this.zoom = -5;
      this.rotation = 45;
      this.currentlyPressedKeys = [];
      this.currentTime = (new Date).getTime();
      document.onkeyup = this.handleKeyUp;
      document.onkeydown = this.handleKeyDown;
      this.models = [];
      this.models[0] = new window.cube;
      if (gl) {
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.clearDepth(1.0);
        gl.enable(gl.DEPTH_TEST);
        gl.depthFunc(gl.LEQUAL);
        gl.initShaders();
        this.models[0].buffer();
        setInterval(this.drawLoop, 15, gl, this);
      }
    }

    Walker.prototype.drawLoop = function(gl, scope) {
      return scope.drawScene(gl);
    };

    Walker.prototype.handleKeyDown = function(event) {
      return window.walker.currentlyPressedKeys[event.keyCode] = true;
    };

    Walker.prototype.handleKeyUp = function(event) {
      return window.walker.currentlyPressedKeys[event.keyCode] = false;
    };

    Walker.prototype.handleKeys = function() {
      if (this.currentlyPressedKeys[37]) {
        this.rotation -= 360 * this.dt();
      }
      if (this.currentlyPressedKeys[39]) {
        this.rotation += 360 * this.dt();
      }
      if (this.currentlyPressedKeys[187]) {
        this.zoom *= 0.9;
      }
      if (this.currentlyPressedKeys[189]) {
        return this.zoom *= 1.1;
      }
    };

    Walker.prototype.dt = function() {
      return ((new Date).getTime() - this.currentTime) / 1000;
    };

    Walker.prototype.drawScene = function(gl, scope) {
      this.handleKeys();
      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
      gl.perspectiveMatrix = makePerspective(45, 640.0 / 480.0, 0.1, 100.0);
      gl.loadIdentity();
      gl.mvTranslate([-0.0, 0.0, this.zoom]);
      gl.mvRotate(45, [1, 0, 0]);
      gl.mvRotate(this.rotation, [0, 1, 0]);
      gl.mvPushMatrix();
      this.models[0].draw();
      gl.mvPopMatrix();
      return this.currentTime = (new Date).getTime();
    };

    return Walker;

  })();

  window.walker_object = Walker;

}).call(this);
